<head><style type="text/css">body,html{max-width:100%;width:100%;height:100%;margin:0;padding:0;background-color:#141013;overflow:hidden}body{display:flex;align-items:center}canvas{display:block;margin:0 auto;image-rendering:-moz-crisp-edges;image-rendering:-webkit-crisp-edges;image-rendering:pixelated;image-rendering:crisp-edges}img{position:absolute;padding:45%;width:10%;image-rendering:-moz-crisp-edges;image-rendering:-o-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor}</style></head><canvas width="256" height="240"></canvas><img id="loading" src="img/loading.gif" alt=""><script type="text/javascript">!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){},function(t,e,i){"use strict";i.r(e);i(0);function n(){this.setSettings=function(t){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var i=this.b+this.c+this.e;if(i<.18){var n=.18/i;this.b*=n,this.c*=n,this.e*=n}}}var s=new function(){var t,e,i,s,a,r,h,o,c,f,l,u;this._params=new n,this.reset=function(){var t=this._params;s=100/(t.f*t.f+.001),a=100/(t.g*t.g+.001),r=1-t.h*t.h*t.h*.01,h=-t.i*t.i*t.i*1e-6,t.a||(l=.5-t.n/2,u=5e-5*-t.o),o=1+t.l*t.l*(t.l>0?-.9:10),c=0,f=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var n=this._params;return t=n.b*n.b*1e5,e=n.c*n.c*1e5,i=n.e*n.e*1e5+12,3*((t+e+i)/3|0)},this.synthWave=function(n,d){var p=this._params,m=1!=p.s||p.v,w=p.v*p.v*.1,y=1+3e-4*p.w,g=p.s*p.s*p.s*.1,v=1+1e-4*p.t,b=1!=p.s,x=p.x*p.x,A=p.g,k=p.q||p.r,E=p.r*p.r*p.r*.2,M=p.q*p.q*(p.q<0?-1020:1020),I=p.p?32+((1-p.p)*(1-p.p)*2e4|0):0,O=p.d,T=p.j/2,C=p.k*p.k*.01,P=p.a,S=t,D=1/t,U=1/e,H=1/i,L=5/(1+p.u*p.u*20)*(.01+g);L>.8&&(L=.8),L=1-L;for(var R,B,W,j,N,_,F=!1,K=0,G=0,q=0,J=0,V=0,z=0,X=0,Y=0,Q=0,Z=0,$=new Array(1024),tt=new Array(32),et=$.length;et--;)$[et]=0;for(et=tt.length;et--;)tt[et]=2*Math.random()-1;for(et=0;et<d;et++){if(F)return et;if(I&&++Q>=I&&(Q=0,this.reset()),f&&++c>=f&&(f=0,s*=o),(s*=r+=h)>a&&(s=a,A>0&&(F=!0)),B=s,T>0&&(Z+=C,B*=1+Math.sin(Z)*T),(B|=0)<8&&(B=8),P||((l+=u)<0?l=0:l>.5&&(l=.5)),++G>S)switch(G=0,++K){case 1:S=e;break;case 2:S=i}switch(K){case 0:q=G*D;break;case 1:q=1+2*(1-G*U)*O;break;case 2:q=1-G*H;break;case 3:q=0,F=!0}k&&((W=0|(M+=E))<0?W=-W:W>1023&&(W=1023)),m&&y&&((w*=y)<1e-5?w=1e-5:w>.1&&(w=.1)),_=0;for(var it=8;it--;){if(++X>=B&&(X%=B,3==P))for(var nt=tt.length;nt--;)tt[nt]=2*Math.random()-1;switch(P){case 0:N=X/B<l?.5:-.5;break;case 1:N=1-X/B*2;break;case 2:N=.225*(((N=1.27323954*(j=6.28318531*((j=X/B)>.5?j-1:j))+.405284735*j*j*(j<0?1:-1))<0?-1:1)*N*N-N)+N;break;case 3:N=tt[Math.abs(32*X/B|0)]}m&&(R=z,(g*=v)<0?g=0:g>.1&&(g=.1),b?(V+=(N-z)*g,V*=L):(z=N,V=0),J+=(z+=V)-R,N=J*=1-w),k&&($[Y%1024]=N,N+=$[(Y-W+1024)%1024],Y++),_+=N}_*=.125*q*x,n[et]=_>=1?32767:_<=-1?-32768:32767*_|0}return d}};var a=function(t){s._params.setSettings(t);var e=s.totalReset(),i=new Uint8Array(4*((e+1)/2|0)+44),n=2*s.synthWave(new Uint16Array(i.buffer,44),e),a=new Uint32Array(i.buffer,0,44);a[0]=1179011410,a[1]=n+36,a[2]=1163280727,a[3]=544501094,a[4]=16,a[5]=65537,a[6]=44100,a[7]=88200,a[8]=1048578,a[9]=1635017060,a[10]=n,n+=44;for(var r=0,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="data:audio/wav;base64,";r<n;r+=3){var c=i[r]<<16|i[r+1]<<8|i[r+2];o+=h[c>>18]+h[c>>12&63]+h[c>>6&63]+h[63&c]}return o},r=function(){var t,e,i,n,s,a=function(t){return Math.sin(6.283184*t)},r=function(t){return.003959503758*Math.pow(2,(t-128)/12)},h=function(t,e,i){var n,s,a,h,c,f,l,u=o[t.i[0]],d=t.i[1],p=t.i[3],m=o[t.i[4]],w=t.i[5],y=t.i[8],g=t.i[9],v=t.i[10]*t.i[10]*4,b=t.i[11]*t.i[11]*4,x=t.i[12]*t.i[12]*4,A=1/x,k=t.i[13],E=i*Math.pow(2,2-t.i[14]),M=new Int32Array(v+b+x),I=0,O=0;for(n=0,s=0;n<v+b+x;n++,s++)s>=0&&(s-=E,f=r(e+(15&(k=k>>8|(255&k)<<4))+t.i[2]-128),l=r(e+(15&k)+t.i[6]-128)*(1+8e-4*t.i[7])),a=1,n<v?a=n/v:n>=v+b&&(a-=(n-v-b)*A),h=f,p&&(h*=a*a),c=u(I+=h)*d,h=l,y&&(h*=a*a),c+=m(O+=h)*w,g&&(c+=(2*Math.random()-1)*g),M[n]=80*c*a|0;return M},o=[a,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}];this.init=function(a){t=a,e=a.endPattern,i=0,n=a.rowLen*a.patternLen*(e+1)*2,s=new Int32Array(n)},this.generate=function(){var r,c,f,l,u,d,p,m,w,y,g,v,b,x,A=new Int32Array(n),k=t.songData[i],E=t.rowLen,M=t.patternLen,I=0,O=0,T=!1,C=[];for(f=0;f<=e;++f)for(p=k.p[f],l=0;l<M;++l){var P=p?k.c[p-1].f[l]:0;P&&(k.i[P-1]=k.c[p-1].f[l+M]||0,P<16&&(C=[]));var S=o[k.i[15]],D=k.i[16]/512,U=Math.pow(2,k.i[17]-9)/E,H=k.i[18],L=k.i[19],R=43.23529*k.i[20]*3.141592/44100,B=1-k.i[21]/255,W=1e-5*k.i[22],j=k.i[23]/32,N=k.i[24]/512,_=6.283184*Math.pow(2,k.i[25]-9)/E,F=k.i[26]/255,K=k.i[27]*E&-2;for(g=(f*M+l)*E,u=0;u<4;++u)if(d=p?k.c[p-1].n[l+u*M]:0){C[d]||(C[d]=h(k,d,E));var G=C[d];for(c=0,r=2*g;c<G.length;c++,r+=2)A[r]+=G[c]}for(c=0;c<E;c++)(y=A[m=2*(g+c)])||T?(v=R,H&&(v*=S(U*m)*D+.5),O+=(v=1.5*Math.sin(v))*(b=B*(y-O)-(I+=v*O)),y=3==L?O:1==L?b:I,W&&(y=(y*=W)<1?y>-1?a(.25*y):-1:1,y/=W),T=(y*=j)*y>1e-5,x=y*(1-(w=Math.sin(_*m)*N+.5)),y*=w):x=0,m>=K&&(x+=A[m-K+1]*F,y+=A[m-K]*F),A[m]=0|x,A[m+1]=0|y,s[m]+=0|x,s[m+1]+=0|y}return++i/t.numChannels},this.createWave=function(){var t=44+2*n-8,e=t-36,i=new Uint8Array(44+2*n);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var a=0,r=44;a<n;++a){var h=s[a];h=h<-32767?-32767:h>32767?32767:h,i[r++]=255&h,i[r++]=h>>8&255}return i}};var h={songData:[{i:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,0,0,69,3,1,1,23,167,0,32,77,6,25,6],p:[1,1,1,1,2,2,1,1,2,2,3,4,3,5,1,1],c:[{n:[120,,,,,,,,122,,,,,,,,117,,,,,,,,,,,,119],f:[]},{n:[120,,,,,,,,122,,,,,,,,117,,,,,,,,,,,,119,,,,124,,,,,,,,126,,,,,,,,132,,,,,,,,,,,,127,,,,132,,,,,,,,134,,,,,,,,129,,,,,,,,,,,,131],f:[]},{n:[132,,,,132,,,,132,,,,132,,,,136,,,,136,,,,136,,,,136,,,,,,136,,,,136,,,,136,,,,136,,,,144,,,,144,,,,144,,,,144],f:[]},{n:[137,,,,137,,,,138,,,,138,,,,139,,,,,,,,137,,,,,,,,,,144,,,,144,,,,144,,,,144,,143,,,,,,,,143],f:[]},{n:[137,,,,137,,,,141,,,,140,,,,139,,,,138,,,,134,,,,,,,,,,144,,,,144,,,,144,,,,144,,,,143,,,,144,,,,138,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,144],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[,,2,2,,,2,2],c:[{n:[],f:[]},{n:[148,,,,,,,,150,,,,,,,,156,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,150],f:[]}]},{i:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,0,0,69,3,1,1,23,167,0,32,77,6,25,6],p:[,,,,2,2,,,2,2],c:[{n:[],f:[]},{n:[,153,,,160,,156,,168,,,165,,,162,,160,,,,148,,,,147,,,,146,,,,,,,,,,,,,,,,,,,,,,,,,,,,150,,,,152],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,0,6,29,0,0,0,195,4,1,3,50,184,119,244,147,6,84,6],p:[,,,,,,,,,,2,3,2,4],c:[{n:[],f:[]},{n:[156,,,,,,,,,,,,,,,,175,,,,,,,,,,,,,,,,160,,,,,,,,,,,,,,,,172],f:[]},{n:[177,,,,,,,,177,,,,,,,,179,,,,,,,,179,,,,,,,,173,,,,,,,,174,,,,,,,,175,,,,,,,,173],f:[]},{n:[177,,,,,,,,180,,,,180,,,,179,,,,177,,,,174,,,,,,,,173,,,,,,,,189,,,,188,,,,187,,,,186,,,,182],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[0,0,140,0,0,0,140,0,0,60,4,10,34,0,0,0,187,5,0,1,239,135,0,32,108,5,67,4],p:[,,11,11,11,11,11,11,11,11,11,11,11,11],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,120,,,,,,,,120,,,,,,,,120,,,,,,,,120],f:[]}]},{i:[0,136,104,1,0,112,104,0,1,93,4,40,21,0,0,0,231,6,1,3,183,15,0,32,232,4,74,6],p:[,,,,12,12,,,12,12],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,117,,,,117,,,,117,,,,117,,,,117,,,,117,,,,117,,,,117],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,255,158,158,158,0,0,0,51,2,1,2,58,239,0,32,88,1,157,2],p:[,,,,,,,,,,13,13,13,13],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[178,,,,,,,,,,,,,,,,180],f:[]}]}],rowLen:5513,patternLen:32,endPattern:15,numChannels:11};const o={0:"FIX THE BROKEN WIRES",1:"USE THE BROWSER BACK BUTTON",2:"DONT FORGET TO SAVE",3:"KEEP GOING BACK",4:"DONT TOUCH THE SPARKS",5:"FLIP THE SWITCH",6:"FLIP IT TWICE",7:"LEAP OF FAITH",8:"BACK AND FORTH",9:"JUMP WITH CAUTION",10:"PATIENCE",11:"GOING UP",12:"SAVE ON THE WAY",13:"UP AND DOWN",14:"MIRRORED",15:"JUMP BACK",16:"TIMING",17:"THE END"};let c={},f={};class l{constructor(t,e,i,n,s=0,a=0){this.img=c[t],this.rect={x:s,y:a,w:e,h:this.img.height},this.hb={x:0,y:0,w:e,h:this.img.height},this.animations=i,this.currAnimation=n,this.frame=0,this.lastUpdate=0}getHb(){return{x:this.rect.x+this.hb.x,y:this.rect.y+this.hb.y,w:this.hb.w,h:this.hb.h}}setAnimation(t){this.currAnimation!==t&&(this.frame=0),this.currAnimation=t}update(t){t-this.lastUpdate>this.animations[this.currAnimation].t&&(this.lastUpdate=t,this.frame++,this.frame=this.frame%this.animations[this.currAnimation].a.length)}draw(t){t.drawImage(this.img,this.rect.h*this.animations[this.currAnimation].a[this.frame],0,this.rect.h,this.rect.h,this.rect.x,this.rect.y,this.rect.h,this.rect.h)}}function u(t,e,i,n,s,a,r,h){return t<s+r&&t+n>s&&e<a+h&&e+n>a}function d(t,e,i,n,s){for(let i of s)if(u(t,e,0,n,i.x,i.y,i.w,i.h))return!0;return!1}class p extends l{constructor(t){super("img/bot.png",8,{idler:{t:240,a:[0,1]},idlel:{t:240,a:[2,3]},walkr:{t:100,a:[4,5,6,7]},walkl:{t:100,a:[8,9,10,11]},jumpl:{t:1e4,a:[13]},jumpr:{t:1e4,a:[12]}},"idler",0,0),this.vy=.1,this.dir="r",this.onWin=t}update(t,e,i,n,s){super.update(t);let a=[...i,...n.filter(t=>t instanceof g).filter(t=>t.collidable()).map(t=>t.getHb())],r=this.rect;e.isDown(e.UP)&&0===this.vy&&(this.vy=-2.1111,f.jump.play()),e.isDown(e.LEFT)?(d(r.x-1,r.y,r.w,r.h,a)||(r.x-=1),this.dir="l",this.setAnimation("walk"+this.dir)):e.isDown(e.RIGHT)?(d(r.x+1,r.y,r.w,r.h,a)||(r.x+=1),this.dir="r",this.setAnimation("walk"+this.dir)):this.setAnimation("idle"+this.dir),this.vy+=.08,r.y+=Math.min(this.vy,4),a.map(t=>{u(r.x,r.y,r.w,r.h,t.x,t.y,t.w,t.h)&&(this.vy>0?(this.vy=0,r.y=t.y-r.h):(this.vy=.01,r.y=t.y+r.h))});let h=!1;n.map(e=>{let{x:i,y:n,w:a,h:o}=e.getHb();u(r.x,r.y,r.w,r.h,i,n,a,o)?e instanceof m?e.activate():e instanceof w?e.fix():e instanceof b?e.switch(t):e instanceof v&&"off"!==e.currAnimation?s():e instanceof y&&e.isOpen&&(f.win.play(),this.onWin(),h=!0):e instanceof b&&(e.enabled=!0)}),this.vy&&this.setAnimation("jump"+this.dir),r.y>240&&s()}}class m extends l{constructor(t,e,i){super("img/entities.png",8,{inactive:{t:1e4,a:[0]},active:{t:90,a:[1,2,3,4,3,2]}},"inactive",t,e),this.onActivate=i}activate(){this.active||(this.active=!0,this.setAnimation("active"),f.save.play(),this.onActivate())}deactivate(){this.active=!1,this.setAnimation("inactive")}}class w extends l{constructor(t,e,i){super("img/entities.png",8,{broken:{t:1e4,a:[Math.floor(3*Math.random()+5)]},fixed:{t:1e4,a:[8]}},"broken",t,e),this.onFix=i,this.hb={x:2,y:2,w:4,h:4}}fix(){this.fixed||(this.fixed=!0,this.setAnimation("fixed"),f.fix.play(),this.onFix())}}class y extends l{constructor(t,e){super("img/entities.png",8,{closed:{t:1e4,a:[9]},open:{t:1e4,a:[12]},opening:{t:1e4,a:[10,11]}},"closed",t,e),this.hb={x:4,y:7,w:0,h:1}}open(){this.setAnimation("open"),this.isOpen=!0}}class g extends l{constructor(t,e,i=!1){super("img/entities.png",8,{floor:{t:1e3,a:i?[13,14]:[14,13]}},"floor",t,e),this.hb={x:0,y:0,w:8,h:4}}collidable(){return 13===this.animations.floor.a[this.frame]}}class v extends l{constructor(t,e,i){super("img/entities.png",8,{blue:{t:1,a:[17,18,19,20]},green:{t:1,a:[21,22,23,24]},off:{t:1,a:[25]}},"blue"===i?i:"off",t,e),this.color=i,this.hb={x:1,y:1,w:6,h:6}}setAnimation(t){super.setAnimation(this.color===t?t:"off")}update(t){"off"!==this.currAnimation&&Math.random()>.2&&(this.frame=Math.floor(4*Math.random()))}}class b extends l{constructor(t,e,i){super("img/entities.png",8,{green:{t:9999,a:[15]},blue:{t:9999,a:[16]}},"blue",t,e),this.onSwitch=i,this.enabled=!0,this.hb={x:0,y:0,w:8,h:8}}switch(){this.enabled&&(this.setAnimation("blue"===this.currAnimation?"green":"blue"),this.onSwitch(this.currAnimation),this.enabled=!1)}}class x{reset(){this.tiles=[],this.entities=[];let t=c["img/levels.png"],e=c["img/tiles.png"],i=document.createElement("canvas");i.width=32,i.height=30,i.getContext("2d").drawImage(t,-32*this.leveln,0),this.canvas=document.createElement("canvas"),this.canvas.width=256,this.canvas.height=240,this.circuitCount=0,this.activatedButtons=[],this.player.rect.x=0,this.player.rect.y=0,this.player.vy=.1,this.textPosition=null;let n=this.canvas.getContext("2d");for(let t=0;t<32;t++)for(let s=0;s<30;s++){let a=8*t,r=8*s,h=i.getContext("2d").getImageData(t,s,1,1).data;255!==h[3]+256*h[2]+256*h[1]*256+256*h[0]*256*256&&n.drawImage(e,8*Math.floor(7*Math.random()+4),0,8,8,a,r,8,8);let o=1;switch(h[3]+256*h[2]+256*h[1]*256+256*h[0]*256*256){case 4294967295:this.tiles.push({t:"floor",x:a,y:r,w:8,h:8}),o=Math.floor(4*Math.random()),n.drawImage(e,8*o,0,8,8,a,r,8,8);break;case 4278190335:let t=new m(a,r,()=>{this.activatedButtons.push(t)});this.entities.push(t);break;case 16711935:this.circuitCount++,this.entities.push(new w(a,r,()=>{this.circuitCount--,this.circuitCount||this.exitDoor.open()}));break;case 65535:this.exitDoor=new y(a,r),this.entities.push(this.exitDoor);break;case 4294902015:this.enterDoor=new y(a,r),this.entities.push(this.enterDoor),this.player.rect={...this.player.rect,x:a,y:r};break;case 4278255615:this.entities.push(new g(a,r));break;case 4291624959:this.entities.push(new g(a,r,!0));break;case 3435986943:this.entities.push(new v(a,r,"blue"));break;case 3439316223:this.entities.push(new v(a,r,"green"));break;case 4291611903:this.entities.push(new b(a,r,t=>{this.entities.filter(t=>t instanceof v||t instanceof b).map(e=>e.setAnimation(t)),f.fix.play()}));break;case 16777215:this.textPosition=[a,r]}}this.textPosition&&o[this.leveln]&&function(t,e,i,n){let s=c["img/font.png"];for(let a=0;a<e.length;a++)" "!==e[a]&&t.drawImage(s,8*(e.charCodeAt(a)-65),0,8,8,8*a+i,n,8,8)}(n,o[this.leveln],this.textPosition[0],this.textPosition[1])}constructor(t,e=0){this.player=t,this.leveln=e,this.reset()}back(){if(this.activatedButtons.length){let t=this.activatedButtons.pop();t.deactivate();let e=this.player.rect,i=t.rect;this.activatedButtons.length&&u(e.x,e.y,e.w,e.h,i.x,i.y,i.w,i.h)&&(t=this.activatedButtons.pop()).deactivate(),this.player.rect={...this.player.rect,x:t.rect.x,y:t.rect.y},this.player.vy=.1}}update(t,e){this.entities.map(e=>e.update(t)),this.player.update(t,e,this.tiles,this.entities,()=>{f.death.play(),this.reset()})}draw(t){t.drawImage(this.canvas,0,0),this.entities.map(e=>e.draw(t)),this.player.draw(t)}}window.onload=()=>{let t=document.querySelector("canvas"),e=t.getContext("2d");function i(){const e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),i=Math.max(document.documentElement.clientHeight,window.innerHeight||0);for(let n=10;n>0;n--)if(t.width*n<e&&t.height*n<i)return t.style.width=t.width*n+"px",void(t.style.height=t.height*n+"px");t.style.width=t.width+"px",t.style.height=t.height+"px"}e.imageSmoothingEnabled=!1,i(),window.addEventListener("resize",i);let n={_pressed:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,isDown:function(t){return this._pressed[t]},onKeydown:function(t){this._pressed[t.keyCode]=!0},onKeyup:function(t){delete this._pressed[t.keyCode]}};window.addEventListener("keyup",function(t){n.onKeyup(t)},!1),window.addEventListener("keydown",function(t){n.onKeydown(t)},!1);let s=[];function o(){for(;s.length<10;){let t=Math.random().toString(36).substring(7);s.push("#"+t),history.pushState(null,null,"#"+t)}}!function(t){let e=["img/levels.png","img/tiles.png","img/bot.png","img/entities.png","img/font.png"],i={jump:a([0,0,.1,.4,.2,.3,0,.1,0,0,0,0,0,.47,0,0,0,0,.5,0,0,.2,0,.5]),fix:a([3,0,.1,.4,.15,.45,0,-.45,0,0,0,0,0,0,0,0,0,0,1,0,0,.4,0,.5]),save:a([0,0,.06,.4,.5,.4,0,.43,0,0,0,0,0,.2,0,.5,0,0,1,0,0,0,0,.5]),death:a([0,0,.3,.4,.3,.4,0,-.4,0,0,0,0,0,.3,0,.4,0,0,1,0,0,0,0,.5]),win:a([0,0,.09,0,.4,.6,0,0,0,0,0,.65,.5,0,0,0,0,0,1,0,0,0,0,.5])};Object.keys(i).map(t=>{f[t]=new Audio,f[t].src=i[t]});let n=e.length;e.map(e=>{let i=new Image;i.onload=()=>{if(!--n){let e=new r;e.init(h);let i=!1;setInterval(function(){if(!i&&(i=e.generate()>=1)){let i=e.createWave(),n=document.createElement("audio");n.src=URL.createObjectURL(new Blob([i],{type:"audio/wav"})),n.volume=.5,n.loop=!0,n.play().then(t).catch(t)}},16)}},i.src=e,c[e]=i})}(()=>{document.getElementById("loading").remove();let i=0,a=new p(()=>{r=new x(a,++i)}),r=new x(a,i);o(),window.addEventListener("keydown",t=>{"Backspace"===t.code&&r.back()},!1),window.addEventListener("hashchange",()=>{for(;s.length&&s.pop()!==location.hash;)r.back();o()},!1),function i(){window.requestAnimationFrame(i),r.update(performance.now(),n),e.clearRect(0,0,t.width,t.height),r.draw(e)}()})}}]);</script>